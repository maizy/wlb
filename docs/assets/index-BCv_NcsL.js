var O=Object.defineProperty;var V=(t,e,n)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var o=(t,e,n)=>V(t,typeof e!="symbol"?e+"":e,n);import{j as s,r as w}from"./jsx-runtime-56DGgGmo.js";import{c as v}from"./consts-DptBCB4Y.js";class L{constructor(e,n,r,i,u){o(this,"content");o(this,"begin");o(this,"end");o(this,"success");o(this,"assumedEnd");this.content=e,this.begin=i,this.end=u,this.success=n,this.assumedEnd=r}}const R=new RegExp(/\d+/),$=new RegExp(/^\d+$/),I=new RegExp(/\d+[ .:-]*[hmd]*/,"g");class m{constructor(e){o(this,"minutes");this.minutes=Math.max(0,e||0)}get formatted(){const e=Math.floor(this.minutes/60);return e>0?this.minutes%60!==0?`${e}h ${this.minutes%60}m`:`${e}h`:`${this.minutes}m`}plus(e){return new m(this.minutes+e.minutes)}minus(e){return new m(this.minutes-e.minutes)}compare(e){return e.minutes<this.minutes?1:e.minutes>this.minutes?-1:0}ge(e){return this.compare(e)>=0}gt(e){return this.compare(e)===1}le(e){return this.compare(e)<=0}lt(e){return this.compare(e)===-1}}function y(t){if(t=t.toLowerCase(),t.match($))return new m(parseInt(t)*60);{const e=t.matchAll(I);let n=0;for(const r of e){const i=r[0].match(R);if(i!==null){const u=parseInt(i[0]);r[0].includes("m")?n+=u:r[0].includes("d")?n+=24*60*u:n+=u*60}}return new m(n)}}class E{constructor(e,n){o(this,"hour");o(this,"minute");this.hour=Math.min(23,Math.max(0,e||0)),this.minute=Math.min(59,Math.max(0,n||0))}get formatted(){const e=(this.minute+"").padStart(2,"0");return`${this.hour}:${e}`}get minutesOfDay(){return this.hour*60+this.minute}compare(e){return e.minutesOfDay<this.minutesOfDay?1:e.minutesOfDay>this.minutesOfDay?-1:0}ge(e){return this.compare(e)>=0}gt(e){return this.compare(e)===1}le(e){return this.compare(e)<=0}lt(e){return this.compare(e)===-1}durationUntil(e){const n=this.compare(e);return n<0?new m(e.minutesOfDay-this.minutesOfDay):n>0?new m(60*24-this.minutesOfDay+e.minutesOfDay):new m(0)}plus(e){let n=this.minutesOfDay+e.minutes;return n=n%(60*24),B(n)}minus(e){let n=this.minutesOfDay-e.minutes;return n=n%(60*24),n<0&&(n=24*60+n),B(n)}}function B(t){return t=Math.min(60*24,Math.max(0,t||0)),new E(Math.floor(t/60),t%60)}function W(){const t=new Date;return new E(t.getHours(),t.getMinutes())}const C=new RegExp(/^\s*([0-9]+)[^0-9]*([0-9]*)\s*$/),P=new RegExp(/\s+[a-z\-â€“\t]*\s*/,"i"),U=new RegExp(/\r?\n/);function b(t){const e=t.match(C);if(e&&e[1]){let n=0;return e[2]&&(n=parseInt(e[2])||0),new E(parseInt(e[1]),n)}}function z(t,e){const n=t.trim().split(P).filter(d=>d.length>0);let r,i,u=!1,h=!1;return n.length===1?(r=b(n[0]),r!==null&&(i=e,h=!0,u=!0)):n.length===2&&(r=b(n[0]),r!==null&&(i=b(n[1])),u=!!r&&!!i),new L(t,u,h,r,i)}function A(t,e){return t.trim().split(U).map(n=>z(n,e))}class x{constructor(e,n,r,i){o(this,"begin");o(this,"end");o(this,"estimatedEnd");o(this,"assumedEnd");o(this,"estimation");this.begin=e,this.end=n,this.estimation=r||!1,this.assumedEnd=i||!1}get duration(){return this.begin.durationUntil(this.end)}get formatted(){return`${this.begin.formatted} - ${this.end.formatted} ${this.estimation?"(estimated)":""}`}}class j{constructor(e,n,r,i){o(this,"workTime");o(this,"userWorkTimeValue");o(this,"lunchBreak");o(this,"userLunchBreakValue");o(this,"minimumBreakRatio",.5);this.workTime=e,this.lunchBreak=n,this.userWorkTimeValue=r!==void 0?r:e.formatted,this.userLunchBreakValue=i!==void 0?i:n.formatted}clone(e){return new j(e.workTime||this.workTime,e.lunchBreak||this.lunchBreak,e.userWorkTimeValue!==void 0?e.userWorkTimeValue:this.userWorkTimeValue,e.userLunchBreakValue!==void 0?e.userLunchBreakValue:this.userLunchBreakValue)}}const D=new j(new m(8*60),new m(60));function J(t){const e=[t.userWorkTimeValue,t.userLunchBreakValue];return JSON.stringify(e)}function F(t){try{const[e,n]=JSON.parse(t),r=y(e),i=y(n);return new j(r,i,e,n)}catch{return D}}function H(t,e,n){const r=[],i=[];t.sort((a,l)=>a.begin.gt(a.end)&&l.begin.lt(l.end)?-1:l.begin.gt(l.end)&&a.begin.lt(a.end)?1:a.begin.compare(l.begin)||a.end.compare(l.end));let u=null;for(const a of t){const l=a.duration;r.push(l),u!==null&&i.push(u.durationUntil(a.begin)),u=a.end}const h=r.reduce((a,l)=>a.plus(l),new m(0)),d=i.reduce((a,l)=>a.plus(l),new m(0));let f=new m(0);if(e.workTime.gt(h)){const a=e.workTime.minus(h),l=d.minutes>0&&d.minutes>=e.lunchBreak.minutes*e.minimumBreakRatio;f=a,l||(f=f.plus(e.lunchBreak));let g=null,k=null;for(let c=t.length-1;c>=0;c--)t[c].assumedEnd&&g===null&&(g=t[c]),t[c].assumedEnd===void 0&&k===null&&(k=t[c]);if(t.length>0&&g!==null)g.estimatedEnd=g.end.plus(f);else if(t.length===0){const c=n,p=new m(Math.floor(e.workTime.minutes/2)),T=e.workTime.minus(p);t.push(new x(c,c.plus(p),!0));const S=c.plus(p).plus(e.lunchBreak);t.push(new x(S,S.plus(T),!0))}else{let c=n;const p=k===null?new m(0):k.end.durationUntil(c);if(!l){const T=e.lunchBreak.minus(p);c=c.plus(T)}t.push(new x(c,c.plus(a),!0))}}return{periods:t,elapsed:h,breaks:d,remaining:f}}function q(t){const e=t.periods.map((n,r)=>{const i=n.assumedEnd?"assumed":void 0,u=[];return n.estimatedEnd&&u.push(s.jsxs("div",{className:"badge estimate-badge",children:["until ",n.estimatedEnd.formatted]},`today-work-period-${r}-until-badge`)),n.estimation&&u.push(s.jsx("div",{className:"badge estimate-badge",children:"estimation"},`today-work-period-${r}-estimate-badge`)),s.jsxs("tr",{className:n.estimation?"estimation":void 0,children:[s.jsx("td",{children:n.begin.formatted}),s.jsx("td",{className:i,children:n.end.formatted}),s.jsx("td",{className:i,children:n.duration.formatted}),s.jsx("td",{className:"badges",children:u})]},`today-work-period-${r}`)});return s.jsxs("table",{id:"today-data",className:"periods-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Begin"}),s.jsx("th",{children:"End"}),s.jsx("th",{children:"Length"}),s.jsx("th",{className:"badges"})]})}),s.jsx("tbody",{children:e})]})}function G(t){return s.jsxs("div",{className:"summary",children:[s.jsx("span",{className:"value-label",children:"Total"})," ",t.enriched.elapsed.formatted]})}const N=`9-15 14-45
15:00 - 15:30
16 - 17
18`;function Q(t){return s.jsxs("div",{children:["Example:",s.jsx("br",{}),s.jsx("button",{className:"input-example",onClick:()=>t.setWorkPeriodsSpec(N),children:N})]})}function X(t){const e=r=>{const i=r.currentTarget.value,u=y(i),h=t.workdaySettings.clone({workTime:u,userWorkTimeValue:i});t.setWorkdaySettings(h)},n=r=>{const i=r.currentTarget.value,u=y(r.currentTarget.value),h=t.workdaySettings.clone({lunchBreak:u,userLunchBreakValue:i});t.setWorkdaySettings(h)};return s.jsxs("div",{children:[s.jsx("h3",{children:"Work schedule"}),"I work "," ",s.jsx("input",{className:"inline",id:"work-time",value:t.workdaySettings.userWorkTimeValue,onChange:e})," ","per day with an approximate"," ",s.jsx("input",{className:"inline",id:"lunch-break",value:t.workdaySettings.userLunchBreakValue,onChange:n})," ","break for lunch."]})}function M(t,e,n,r){const[i,u]=w.useState(e);return w.useEffect(()=>{const d=localStorage.getItem(t);d!==null&&u(r(d))},[t,r]),[i,d=>{localStorage.setItem(t,n(d)),u(d)}]}function Y(t){const[e,n]=w.useState(W());return w.useEffect(()=>{function r(){n(W())}const i=new Date,u=Math.min(6e4,6e4),h=Math.min(u,6e4-(i.getSeconds()*1e3+i.getMilliseconds())),d=window.setTimeout(r,h);return()=>{clearTimeout(d)}},[e,n,t]),e}const ee=()=>[v.title(),v.description];function te(){const[t,e]=M("work-periods","",a=>a,a=>a),[n,r]=M("workday-settings",D,J,F),i=a=>{e(a.currentTarget.value)},u=Y(),d=A(t,u).flatMap(a=>a.success&&a.begin&&a.end?[new x(a.begin,a.end,!1,a.assumedEnd)]:[]),f=H(d,n,u);return s.jsxs(s.Fragment,{children:[s.jsxs("h1",{children:["WLB ",s.jsx("span",{className:"app-version",children:v.version})]}),s.jsxs("div",{id:"grid",children:[s.jsxs("div",{id:"input",className:"grid-cell",children:[s.jsx("h3",{className:"first-header",children:"Worktime"}),s.jsx("textarea",{className:"input-area",id:"time-input",value:t,onInput:i}),s.jsxs("div",{className:"description",children:[s.jsx("p",{children:"One work period per line. Only the 24-hour clock format is supported for now."}),s.jsx("p",{children:"If an end time is omitted current time is assumed."}),s.jsx("p",{children:"Try to use any time format you like."}),s.jsx(Q,{setWorkPeriodsSpec:e}),s.jsx("p",{children:"All entered data are saved locally in your browser only."})]})]}),s.jsxs("div",{id:"days",className:"grid-cell",children:[s.jsxs("div",{id:"current-day",children:[s.jsx("h3",{className:"first-header",children:"Today"}),s.jsxs("div",{id:"today-periods",children:[s.jsx(q,{periods:f.periods}),s.jsx(G,{enriched:f})]})]}),s.jsx("div",{id:"configs",children:s.jsx(X,{workdaySettings:n,setWorkdaySettings:r})})]})]})]})}export{te as default,ee as meta};
